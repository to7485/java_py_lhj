<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Todo List (Complete Version)</title>

    <style>
        * { box-sizing: border-box; }

        body {
            font-family: sans-serif;
            background-color: #f5f5f5;
            padding: 40px;
        }

        .container {
            width: 480px;
            margin: auto;
            background: #fff;
            padding: 20px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .todo-input-area {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #todo-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        #add-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            background: #3498db;
            color: #fff;
            cursor: pointer;
        }

        #add-btn:hover {
            background: #2980b9;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        .todo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafafa;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .todo-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .todo-text.done {
            text-decoration: line-through;
            color: #aaa;
        }

        .delete-btn {
            border: none;
            background: none;
            color: #e74c3c;
            cursor: pointer;
        }

        .empty-text {
            text-align: center;
            color: #888;
            margin-top: 20px;
        }
    </style>
</head>

<body>
<div class="container">
    <h2>Todo List</h2>

    <div class="todo-input-area">
        <input id="todo-input" type="text" placeholder="할 일을 입력하세요" />
        <button id="add-btn">추가</button>
    </div>

    <ul id="todo-list"></ul>
    <p id="empty-text" class="empty-text">아직 등록된 할 일이 없습니다.</p>
</div>

<script>
    const todoInput = document.getElementById("todo-input");
    const addBtn = document.getElementById("add-btn");
    const todoList = document.getElementById("todo-list");
    const emptyText = document.getElementById("empty-text");

    // -------------------------------------
    // TODO 리스트 렌더링 (체크박스 + 삭제버튼 포함)
    // -------------------------------------
    function renderTodoList(todos) {
        todoList.innerHTML = "";

        if (!todos || todos.length === 0) {
            emptyText.style.display = "block";
            return;
        }
        emptyText.style.display = "none";

        todos.forEach(todo => {
            const li = document.createElement("li");
            li.className = "todo-item";

            // 왼쪽: 체크박스 + 텍스트
            const left = document.createElement("div");
            left.className = "todo-left";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.checked = todo.done;

            const span = document.createElement("span");
            span.className = "todo-text";
            span.textContent = todo.title;

            if (todo.done) span.classList.add("done");

            checkbox.addEventListener("change", () => {
                span.classList.toggle("done");

                // (선택) 서버로 UPDATE 요청 보낼 수 있음
                // fetch("http://localhost:8080/todo/update", {...})
            });

            left.appendChild(checkbox);
            left.appendChild(span);

            // 오른쪽: 삭제 버튼
            const delBtn = document.createElement("button");
            delBtn.className = "delete-btn";
            delBtn.textContent = "삭제";

            delBtn.addEventListener("click", () => {
                deleteTodo(todo.id);
            });

            li.appendChild(left);
            li.appendChild(delBtn);

            todoList.appendChild(li);
        });
    }

    // -------------------------------------
    // 첫 로딩 시 목록 조회
    // -------------------------------------
    async function loadTodos() {
        const response = await fetch("http://localhost:8080/todo");
        const result = await response.json();
        if (result.data) renderTodoList(result.data);
    }

    window.addEventListener("DOMContentLoaded", loadTodos);

    // -------------------------------------
    // TODO 생성
    // -------------------------------------
    async function addTodo() {
        const text = todoInput.value.trim();
        if (text === "") return alert("내용을 입력하세요");

        const response = await fetch("http://localhost:8080/todo/createTodo", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title: text })
        });

        const result = await response.json();

        if (result.data) renderTodoList(result.data);

        todoInput.value = "";
        todoInput.focus();
    }

    // Enter 입력 → 추가
    todoInput.addEventListener("keydown", e => {
        if (e.key === "Enter") addTodo();
    });

    addBtn.addEventListener("click", addTodo);

    // -------------------------------------
    // TODO 삭제
    // -------------------------------------
    async function deleteTodo(id) {
        try {
            const response = await fetch(`http://localhost:8080/todo/${id}`, {
                method: "DELETE"
            });

            const result = await response.json();

            if (result.data) renderTodoList(result.data);
        } catch (err) {
            alert("삭제 중 오류 발생");
        }
    }


</script>
</body>
</html>
